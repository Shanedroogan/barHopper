{% extends "base.html" %}

{% block app_content %}
<div id="alert"></div>
<!--Buttons-->
<div class="row" style = "margin-bottom: 0px; padding-bottom: 0px; margin-top:1.1rem">
    <!--Back Button-->
    <div class="col-md-6">
        <a href ="{{ url_for('customize_crawl') }}" type = "button" class="btn btn-secondary"><i class="fas fa-angle-left"></i> Go Back</a>
    </div><!--End Back Button-->
    <div class="col-md-4">
      {% if not saved %}
        <form action="">
            <input type="button" id = "submit" name="save" class="btn btn-secondary" value="Save to Profile"/>
        </form>
      {% else %}
        <button class= "btn btn-secondary" disabled>Saved <i class="fas fa-check"></i></button>
      {% endif %}
    </div>
</div><!--End Buttons-->

<div class = "row" style="margin-top: 0px; padding-top: 0px;">
    <!--Bar Information-->
    <div class="col-md-6">
      <div class="accordion">
        {% for bar in bars %}
        {% set bar_index = loop.index0 %}
        <div class="card">
          <div class="row">
            <div class="col-3">
              {% include '_output_tab_nav.html' %}
            </div>
            <div class="col-9">
              {% include '_output_tab_content.html' %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div><!--End Bar Information-->
    <!--Interactive Map-->
    <div class = "col-md-6">
      <div id="map">

      </div>
    </div><!--End Interactive Map-->
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
  var polyline = ""
  // Initialize and add the map
  function initMap() {
    //Init directions service
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer();
    // The location of the bar hop
    var hop = {lat: parseFloat('{{bars[2].latitude|safe}}'), lng: parseFloat('{{bars[2].longitude|safe}}')};
    var mapOptions = {
      zoom : 14,
      center : hop,
      styles : [
  {
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#242f3e"
      }
    ]
  },
  {
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#746855"
      }
    ]
  },
  {
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "color": "#242f3e"
      }
    ]
  },
  {
    "featureType": "administrative.land_parcel",
    "elementType": "labels",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "administrative.locality",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#d59563"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#d59563"
      }
    ]
  },
  {
    "featureType": "poi.attraction",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.business",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.government",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.medical",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#263c3f"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "labels.text",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#6b9a76"
      }
    ]
  },
  {
    "featureType": "poi.place_of_worship",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.school",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "poi.sports_complex",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#38414e"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "geometry.stroke",
    "stylers": [
      {
        "color": "#212a37"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9ca5b3"
      }
    ]
  },
  {
    "featureType": "road.arterial",
    "stylers": [
      {
        "visibility": "on"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#746855"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "geometry.stroke",
    "stylers": [
      {
        "color": "#1f2835"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#f3d19c"
      }
    ]
  },
  {
    "featureType": "road.highway.controlled_access",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "featureType": "road.local",
    "stylers": [
      {
        "visibility": "on"
      }
    ]
  },
  {
    "featureType": "transit",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#2f3948"
      }
    ]
  },
  {
    "featureType": "transit.station",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#d59563"
      }
    ]
  },
  {
    "featureType": "transit.station.rail",
    "stylers": [
      {
        "visibility": "simplified"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#17263c"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#515c6d"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "color": "#17263c"
      }
    ]
  }
]
    }
    // The map, centered at the barhop
    var map = new google.maps.Map(
        document.getElementById('map'), mapOptions);
    directionsRenderer.setMap(map)
  }
  function calcRoute() {
  var start = '{{bars[0].address}}';
  var end = '{{bars[0].address}}';
  var request = {
    origin: start,
    destination: end,
    travelMode: 'WALKING',
    waypoints : [
        {
          location: '{{bars[1].address|safe}}',
          stopover : true
        },{
          location: '{{bars[2].address|safe}}',
          stopover : true
        },{
          location: '{{bars[3].address|safe}}',
          stopover : true
        },{
          location: '{{bars[4].address|safe}}',
          stopover : true
        }],
        optimizeWaypoints : true
  };
  directionsService.route(request, function(result, status) {
    if (status == 'OK') {
      directionsRenderer.setDirections(result);
      polyline = result.routes[0].overview_polyline
    }
  });
}
$('#submit').click(function() {
        console.log(polyline);
        $.ajax({
          type: "POST",
          contentType: "application/json;charset=utf-8",
          url: "{{ url_for('output', result_list=request.args.get('result_list')) }}",
          traditional: "true",
          data: JSON.stringify({polyline}),
          dataType: "json"
          });
          this.value = "Saved!"
          $(this).prop('disabled', true);
    });
</script>
      <script async defer
      src='{{ maps_endpoint }}'>
      </script>
      <script>
        window.onload = calcRoute
      </script>
{% endblock %}